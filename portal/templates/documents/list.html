{% extends "base.html" %}
{% block title %}Documents{% endblock %}
{% block page_actions %}
<link rel="stylesheet" href="{{ asset_url('toolbar/toolbar.css') }}">
<div class="toolbar" data-component="toolbar" data-variant="icon-text">
  <a href="/documents/new" class="btn btn-primary" data-action="new"><svg class="icon"><use xlink:href="#icon-plus"></use></svg><span>New</span></a>
  <a href="#" class="btn btn-outline-primary" data-action="import"><svg class="icon"><use xlink:href="#icon-upload"></use></svg><span>Import</span></a>
  <a href="#" class="btn btn-outline-primary" data-action="export"><svg class="icon"><use xlink:href="#icon-download"></use></svg><span>Export</span></a>
  <button type="button" class="btn btn-outline-secondary" data-action="filter"><svg class="icon"><use xlink:href="#icon-filter"></use></svg><span>Filter</span></button>
</div>
<script type="module" src="{{ asset_url('toolbar/toolbar.js') }}"></script>
{% endblock %}
{% block content %}
  <h1 class="fw-bold" style="font-size: var(--font-size-lg); margin-bottom: var(--spacing-md);">Documents</h1>
  <form hx-get="{{ url_for('documents_table') }}" hx-target="#document-table" hx-push-url="true" class="row d-none" data-component="filters" style="gap: var(--spacing-sm); margin-bottom: var(--spacing-md);">
  <div class="col-md-3"><input class="form-control" name="q" placeholder="Search" value="{{ filters.q or '' }}" data-filter="text"></div>
    <div class="col-md-3">
      <select class="form-select" name="status" data-filter="select">
        <option value="">Any status</option>
        <option value="Draft" {% if filters.status=='Draft' %}selected{% endif %}>
          Draft{% if facets.status %} ({{ facets.status.get('Draft', 0) }}){% endif %}
        </option>
        <option value="Approved" {% if filters.status=='Approved' %}selected{% endif %}>
          Approved{% if facets.status %} ({{ facets.status.get('Approved', 0) }}){% endif %}
        </option>
        <option value="Published" {% if filters.status=='Published' %}selected{% endif %}>
          Published{% if facets.status %} ({{ facets.status.get('Published', 0) }}){% endif %}
        </option>
      </select>
    </div>
    <div class="col-md-3">
      <select class="form-select" name="department" data-filter="select">
        <option value="">Any department</option>
        {% for d in departments %}
        <option value="{{ d }}" {% if filters.department == d %}selected{% endif %}>
          {{ d }}{% if facets.department %} ({{ facets.department.get(d, 0) }}){% endif %}
        </option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <select class="form-select" name="standard" data-filter="select">
        <option value="">Any standard</option>
        {% for s in standards %}
        <option value="{{ s }}" {% if filters.standard == s %}selected{% endif %}>
          {{ s }}{% if facets.standard %} ({{ facets.standard.get(s, 0) }}){% endif %}
        </option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <select class="form-select" multiple name="tags" data-filter="multi-tag">
        {% for t in filters.tags or [] %}
        <option value="{{ t }}" selected>{{ t }}</option>
        {% endfor %}
    </select>
  </div>
  <div class="col-md-3">
    <div class="d-flex">
      <input type="date" class="form-control me-1" name="start" value="{{ filters.start or '' }}" data-filter="date-start">
      <input type="date" class="form-control" name="end" value="{{ filters.end or '' }}" data-filter="date-end">
    </div>
  </div>
  <div class="col-md-3"><button class="btn btn-primary w-100" type="submit">Filter</button></div>
  <div class="col-md-3"><button class="btn btn-outline-secondary w-100" type="button" data-action="clear-filters">Clear</button></div>
</form>
  <div id="active-filters" data-active-filters style="margin-bottom: var(--spacing-md);"></div>
<div id="document-table">
  {% include 'documents/_table.html' %}
</div>
<script type="module" src="{{ asset_url('document_list.js') }}"></script>
{% endblock %}
