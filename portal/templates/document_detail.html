{% extends "base.html" %}
{% block title %}Document Detail{% endblock %}
{% block content %}
{% macro version_list(doc, revisions) %}
<form method="get" action="{{ url_for('compare_document_versions', doc_id=doc.id) }}">
<ul class="list-group">
  {% for rev in revisions %}
  <li class="list-group-item d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center">
      <input class="form-check-input me-2" type="checkbox" name="rev_id" value="{{ rev.id }}" id="rev-{{ rev.id }}">
      <a hx-get="{{ url_for('document_detail', doc_id=doc.id, revision_id=rev.id) }}" hx-target="#version-area" hx-push-url="false">{{ rev.major_version }}.{{ rev.minor_version }}</a>
    </div>
    <small class="text-muted">{{ rev.created_at.strftime('%Y-%m-%d') if rev.created_at else '' }}</small>
  </li>
  {% else %}
  <li class="list-group-item">No versions found.</li>
  {% endfor %}
</ul>
<button type="submit" class="btn btn-primary mt-2">Compare</button>
</form>
{% endmacro %}

{% macro version_detail(doc, revision) %}
<div>
  <h3>Version {{ revision.major_version }}.{{ revision.minor_version }}</h3>
  <p>{{ revision.revision_notes or 'No revision notes.' }}</p>
  <button class="btn btn-secondary" hx-get="{{ url_for('document_detail', doc_id=doc.id) }}" hx-target="#version-area" hx-push-url="false">Back</button>
</div>
{% endmacro %}

{% if partial %}
  {% if revision %}
    {{ version_detail(doc, revision) }}
  {% else %}
    {{ version_list(doc, revisions) }}
  {% endif %}
{% else %}
<h1>{{ doc.title }}</h1>
<ul class="nav nav-tabs" id="document-tabs">
  <li class="nav-item"><a class="nav-link active" href="#" data-tab="metadata">Metadata</a></li>
  <li class="nav-item"><a class="nav-link" href="#" data-tab="versions">Versions</a></li>
</ul>
<div class="mt-3">
  <div id="tab-metadata">
    <dl>
      <dt>Code</dt><dd>{{ doc.code }}</dd>
      <dt>Status</dt><dd>{{ doc.status }}</dd>
      <dt>Department</dt><dd>{{ doc.department }}</dd>
      <dt>Tags</dt><dd>{{ doc.tags }}</dd>
    </dl>
  </div>
  <div id="tab-versions" class="d-none">
    <div id="version-area">
      {{ version_list(doc, revisions) }}
    </div>
  </div>
</div>
<script src="{{ asset_url('document_detail.js') }}" defer></script>
{% endif %}
{% endblock %}
